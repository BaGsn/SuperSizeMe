<!doctype html>
<html lang="">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui">
		<title>Editor</title>
		<link rel="stylesheet" href="dist/reset.css" type="text/css" />
		<!--media="screen"-->
		<link rel="stylesheet" href="dist/print.css" type="text/css" media="print" />
		<style>
		</style>
		<script>
		var fontBook = {
			urlMini: './fonts/0_narrow.otf',
			urlMiddle: './fonts/middle.otf',
			urlMaxi: './fonts/1_extended.otf',
			staticFontValue: []
		}
		/*
		var x=0;
		var y=1;
		var rList=[];
		var rt=document.getElementsByClassName('rt');
		var random=Math.random()*(y*(1-x));
		for(var i=0;i<rt.length-1;i++){
			var random=Math.random()*(y*(1-x));
			rList.push(random);
			rt.style.flex=random;
			console.log(random);
		}*/
		</script>
	</head>
	<body>
<div class="workspace">
<span class="rt">Alice opened the door and found that it led into a small passage not much larger</span>

<span class="rt">than a rathole she knelt down and looked along the passage into the loveliest</span>

<span class="rt">garden you ever saw. How she longed to get out of that dark hall and wander</span>

<span class="rt">about among those beds of bright flowers and those cool fountains but she could</span>

<span class="rt">not even get her head though the doorway and even if my head would go</span>

<span class="rt">through thought poor Alice it would be of very little use without my shoulders.</span>

<span class="rt">Oh how I wish I could shut up like a telescope! I think I could if I only knew how</span>

<span class="rt">to begin. For you see so many out of the way things had happened lately that</span>

<span class="rt">Alice had begun to think that very few things indeed were really impossible.</span>

<span class="rt" style="width:70%;">There seemed to be no use in waiting by the little door </span>

<span class="rt">so she went back to the table half hoping she might find another key on it or at</span>

<span class="rt">any rate a book of rules for shutting people up like telescopes this time she</span>

<span class="rt">found a little bottle on it ( which certinly was not here before said Alice) and</span>

<span class="rt">tied round the neck of the bottle was a paper label with the words DRINK ME </span>

<span class="rt">beautifully printed on it in large letters. It was all very well to say Drink me but</span>

<span class="rt">the wise little Alice was not going to do that in a hurry. No I’ll look first she</span>

<span class="rt">said and see whether it’s marked ‘poison’ or not for she had read several nice</span>

<span class="rt">little stories about children who had got burnt and eaten up ￼</span>

<span class="rt alone" style="width:35%;">Alice ventured to taste it.</span>

<span class="rt">by wild beasts and other unpleasant things all because they would not</span>

<span class="rt">remember the simple rules their friends had taught them such as that a redhot poker</span>

<span class="rt">will burn you if you hold it too long and that if you cut your finger very deeply</span>

<span class="rt">with a knife it usually bleeds and she had never forgotten that if you drink much</span>

<span class="rt">from a bottle marked poison it is almost certin to disagree with you sooner or later.</span>

<span class="rt">However this bottle was not marked poison so Alice ventured to taste it and</span>

<span class="rt">finding it very nice (it had in fact a sortof mixed flavour of cherrytartcustard</span>

<span class="rt">pineapple roast turkey toffee and hot buttered toast) she very soon finished it off.</span>

<span class="rt"> What a curious feeling! said Alice. I must be shutting up like a telescope! </span>

<span class="rt">And so it was indeed she was now only ten inches high and her face brightened</span>

<span class="rt">up at the thought that she was now the right size for going though the little door</span>

<span class="rt">into that lovely garden. First however she waited for a few minutes to see if she</span>

<span class="rt">was going to shrink any furter she felt a little nervous about this for it might</span>

<span class="rt">end you know said Alice to herself in my going out altogether like a candle.</span>

<span class="rt">I wonder what I should be like then? And she tried to fancy what the flame</span>

<span class="rt">of a candle looks like after the candle is blown out for she could not remember ever having seen </span>

<span class="rt alone" style="width:80%;">She tried her best to climb up one of the legs of the table.</span>

<span class="rt" style="width:15%;">such a thing.</span>
</div>









		<canvas id="hidden-canvas" width="1024" height="1024" hidden />
		<script src="dist/plumin.js"></script>
		<script src="dist/supersizeme.js"></script>
		<script id="workerscript" type="text/workerscript">
		var otFont,
			otFont0,
			otFont1,
			font,
			font0,
			font1,
			coefx;
			coefy=0;
		
		// importScripts doesn't work with inline worker.
		// The following placeholder will be replaced with plumin source.
		// You wouldn't use inline workers and this trick in prod, though.
		PLUMINSOURCE
		
		plumin.paper.install(this);
		plumin.paper.setup({
			width: 1024,
			height: 1024
		});
		
		// Overwrite addToFonts to send the buffer over to the UI
		plumin.paper.Font.prototype.addToFonts = function(id) {
			var buffer = this.ot.toArrayBuffer();
			postMessage( {
				buf:buffer,
				id: id
			}, [buffer] );
		};
		
		onmessage = function( message ) {
			var data = message.data;
			switch ( Object.prototype.toString.call(data) ) {
			// parse incoming .otf ArrayBuffers
			case '[object Object]':
				if ( Object.keys(data)[0] === "lig"){
					if ( !data.lig || data.lig.constructor !== ArrayBuffer ) {
						return;
					}
			
					otFont = plumin.opentype.parse( data.lig );
					otFont0 = plumin.opentype.parse( data.lig );
					otFont1 = plumin.opentype.parse( data.hea );
			
					//console.log(plumin.opentype.parse( data.lig ));
					//console.log(plumin.opentype.parse( data.lig ));
			
					font = new plumin.paper.Font();
					// save default encoding
					var encoding = font.ot.encoding;
					font.importOT( otFont );
					font.ot.familyName = 'font';
					font.ot.encoding = encoding;
			
					font0 = new plumin.paper.Font();
					font0.importOT( otFont0 );
					font0.ot.familyName = 'font0';
			
					font1 = new plumin.paper.Font();
					font1.importOT( otFont1 );
					font1.ot.familyName = 'font1';
					break;
				}else if ( Object.keys(data)[0] === "x" && data.x!="undefined"){
					if (font) {
						for(var i=0;i<Object.keys(data)[0].length;i++){
							coefx=data.x[i];
							coefy=data.y[i];
							font.interpolate(font0, font1, coefx, coefy);
							font.updateOTCommands();
							font.addToFonts(i);
						}
				
					}
				
					break;
				}
		
			// parse incoming subset
			case '[object String]':
				// TODO: optimize to only interpolate new glyphs added to the subset
				if (font) {
					font.subset = data;
					font.interpolate(font0, font1, coefx, coefy);
					font.updateOTCommands();
					font.addToFonts();
				}
				break;

			// parse incoming interpolation coef
			case '[object Array]':
				if (font) {
					data.forEach(function(coefx, i) {
						font.interpolate(font0, font1, coefx, coefx);
						font.updateOTCommands();
						font.addToFonts(i);
					})
			
				}
			
				break;
			}
		};
	</script>
	</body>
</html>
